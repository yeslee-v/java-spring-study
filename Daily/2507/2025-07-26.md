# JPA 2장: JPA 시작
- 소스코드 다운로드: 소스코드 sdk 버전 너무 낮아서 24로 올림
- h2 실행: `bin/h2.sh`

## Maven(메이븐)
- 라이브러리 관리 도구
	- 관리 기능: 자바 애플리케이션 개발 시, jar 파일로 된 여러 라이브러리 필요한데, 과거에는 직접 다운받았다면 메이븐은 이름/버전만 명시하면 라이브러리 자동으로 내려받고 관리함
	- 빌드 기능: 애플리케이션 빌드 표준 방법 제공
- `pom.xml`: 사용할 라이브러리(`.jar`) 적으면 → Maven 공식 저장소에서 라이브러리 자동으로 다운로드 및 관리
### JPA에서 하이버네이트 구현체 사용 시, 핵심 라이브러리
1. JPA, 하이버네이트(`hibernate-entitymanager`): JPA 표준 및 하이버네이트 포함 라이브러리
	- `hibernate-core.jar`
	- `hibernate-jpa-2.1-api.jar`
2. H2 데이터베이스

## JPA 제공 매핑 어노테이션
```java
// 자바 어노테이션 패키지
import java.persistence.*;
```
- @Entity: 엔티티 클래스 → 해당 클래스를 테이블과 매핑한다고 JPA한테 알려줌
- @Table: 엔티티 클래스에 매핑할 테이블 정보 알려줌, 생략하면 클래스 이름을 테이블 이름으로 매핑
- @Id: 식별자 필드 → 엔티티 클래스의 필드를 테이블 기본 키(pk)에 매핑
- @Column: 필드를 컬럼에 매핑
- 만약 매핑 어노테이션이 없거나 생략하면, 필드명을 사용해서 컬럼명으로 매핑한다
	- 대소문자 구분하는 db 사용 시, 명시적 매핑(`@Column(name=”AGE”)`)해야 한다

## persistence.xml
- JPA가 설정 정보 관리하는 파일 → META-INF/persistence.xml 클래스 패스 경로에 있으면 JPA가 인식
## 데이터베이스 방언
- 방언(Dialect): SQL 표준을 지키지 않거나 특정 데이터베이스만의 고유 기능 → JPA가 방언 규칙 강제하지 않음
	- VARCHAR(MySQL), VARCHAR2(Oracle)
## 애플리케이션 개발
### 엔티티 매니저 설정
1. 엔티티 매니저 팩토리 생성: 생성 비용이 아주 크므로 애플리케이션 전체에서 딱 한 번만 생성, 공유해서 사용해야한다
2. 엔티티 매니저 생성: JPA의 대부분의 기능은 엔티티 매니저가 제공함 → 엔티티를 db에 CRUD
		- 내부에 데이터소스(db 커넥션)를 유지하면서 db와 통신
		- db 커넥션과 밀접한 관계 → 스레드 간에 공유하거나 재사용 불가
3. 종료: 사용 끝난 엔티티 매니저, 엔티티 매니저 팩토리는 반드시 종료해야
```java
// 엔티티 매니저 팩토리 생성
EntityManagerFactory emf = Persistence.createEntityManagerFactory("jpabook");

// 엔티티 매니저 생성
EntityManager em = emf.createEntityManager();

em.close(); // 엔티티 매니저 종료
emf.close(); // 엔티티 매니저 팩토리 종료
```
### 트랜잭션 관리
- JPA 사용 시, 항상 트랜잭션 안에서 데이터 변경해야 → 예외 방지
### 비즈니스 로직
- 엔티티 값 변경: JPA가 변경된 엔티티를 추적
## JPQL(Java Persistence Query Language)
- SQL을 추상화한 객체지향 쿼리 언어
- 엔티티(클래스, 필드) 대상으로 쿼리 → 데이터베이스 테이블은 모른다.